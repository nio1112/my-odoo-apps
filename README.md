# My Odoo Apps - 问货管理系统

[![License: LGPL-3](https://img.shields.io/badge/License-LGPL--3-blue.svg)](https://www.gnu.org/licenses/lgpl-3.0)
[![Odoo Version](https://img.shields.io/badge/Odoo-19.0-green.svg)](https://www.odoo.com)
[![Python](https://img.shields.io/badge/Python-3.10%2B-blue.svg)](https://www.python.org)

一个基于 Odoo 19.0 的企业级问货管理系统，专门为制造业和分销业设计，用于优化客户需求收集、库存管理和采购流程。

## 📋 功能概述

### 核心功能

#### 🛒 问货管理 (Ask Management)
- **问货单管理**: 支持一次性、周期性（7/14/21/28天）问货单创建
- **多渠道支持**: 电话、邮件、客户门户、手工录入等来源
- **智能工作流**: 草稿 → 已提交 → 已锁定 → 已聚合 → 已关闭
- **产品明细**: 支持多产品、多仓库的问货需求

#### 📦 库存预留系统
- **智能预留**: 基于问货单创建产品预留
- **销售员绑定**: 预留可绑定特定销售员，确保库存分配
- **时效管理**: 14天预留有效期，超期自动提醒
- **出库控制**: 只有指定销售员可验证预留产品的出库

#### 📊 采购决策支持
- **数据聚合**: 自动汇总所有已锁定问货单的需求数量
- **采购仪表盘**: 按产品、仓库维度展示采购建议
- **历史分析**: 基于历史数据计算建议采购数量
- **供应商协调**: 支持采购订单关联和跟踪

#### ⏰ 自动化调度
- **定时截单**: 每日23:59自动截单，锁定需求
- **状态流转**: 自动将问货数量复制为有效数量
- **审计日志**: 完整记录所有状态变更和数量调整
- **仓储费用**: 自动计算超期预留的仓储费用

## 🏗️ 系统架构

```
my-odoo-apps/
├── addons/
│   └── odoo_ask/                 # 问货管理模块
│       ├── models/               # 数据模型
│       │   ├── ask.py           # 问货单核心模型
│       │   ├── reservation.py   # 预留管理模型
│       │   ├── stock_picking.py # 出库控制扩展
│       │   └── scheduler.py     # 定时任务调度
│       ├── wizard/              # 向导工具
│       │   └── ask_wizard.py    # 问货单创建向导
│       ├── views/               # 视图定义
│       │   ├── ask_views.xml    # 问货单视图
│       │   ├── reservation_views.xml # 预留视图
│       │   └── procurement_dashboard.xml # 采购仪表盘
│       ├── security/            # 权限控制
│       ├── data/               # 初始数据
│       └── static/             # 静态资源
├── docker-compose.yml          # Docker 部署配置
└── README.md                   # 项目文档
```

## 🚀 快速开始

### 环境要求
- Docker 20.10+
- Docker Compose 2.0+
- 至少 4GB 可用内存

### 一键部署
```bash
# 克隆项目
git clone https://github.com/nio1112/my-odoo-apps.git
cd my-odoo-apps

# 启动服务
docker-compose up -d

# 等待服务启动完成（约1-2分钟）
docker-compose logs -f odoo
```

### 访问系统
- **Odoo 界面**: http://localhost:8069
- **数据库**: postgresql://odoo:odoo@localhost:5432/odoo

### 初始化配置
1. 创建新数据库：
   - 数据库名: `odoo`
   - 管理员邮箱: `admin@example.com`
   - 管理员密码: `admin`

2. 安装问货管理模块：
   - 进入 Apps 菜单
   - 搜索 "Ask Management"
   - 点击安装

## 💼 业务场景

### 1. 销售人员收集客户需求
```
客户电话: "我们下周需要100个A产品和50个B产品"
销售人员 → 创建问货单 → 设置周期性问货 → 提交系统
```

### 2. 系统自动处理
```
每日23:59 → 截单处理 → 锁定需求 → 生成采购建议
```

### 3. 采购决策
```
采购经理 → 查看仪表盘 → 确认总需求 → 创建采购订单
```

### 4. 库存管理
```
仓库管理员 → 接收采购货品 → 创建预留 → 通知销售员
```

### 5. 发货控制
```
销售员 → 创建销售订单 → 验证出库 → 系统检查预留权限
```

## 🔧 技术特性

### 数据模型设计
- **Ask (ask.ask)**: 问货单主表，包含客户、日期、状态等信息
- **Ask Line (ask.line)**: 问货明细，支持产品、数量、仓库等字段
- **Reservation (ask.reservation)**: 预留记录，控制库存分配和使用权限
- **Storage Fee (ask.storage_fee)**: 仓储费用计算

### 权限控制
- **销售用户**: 创建和管理问货单
- **采购用户**: 查看采购仪表盘和创建采购订单
- **仓库用户**: 管理库存预留和发货
- **管理员**: 完全访问权限

### 集成扩展
- **库存模块**: 扩展出库验证逻辑
- **销售模块**: 关联客户和销售订单
- **采购模块**: 集成采购订单创建
- **会计模块**: 支持仓储费用核算

## 📊 数据流程

```mermaid
graph TD
    A[客户需求] --> B[创建问货单]
    B --> C{审核提交}
    C -->|是| D[每日截单]
    C -->|否| B
    D --> E[锁定需求]
    E --> F[采购聚合]
    F --> G[采购决策]
    G --> H[库存预留]
    H --> I{发货申请}
    I --> J{权限检查}
    J -->|通过| K[验证出库]
    J -->|拒绝| L[权限提醒]
```

## 🧪 测试用例

### 功能验证
1. **基础流程测试**: 创建问货单 → 截单处理 → 采购聚合
2. **预留控制测试**: 创建预留 → 验证出库权限控制
3. **定时任务测试**: 手动触发截单，验证状态变更
4. **仪表盘测试**: 验证数据聚合和采购建议准确性

### 性能测试
- 支持 1000+ 并发用户
- 10万+ 问货单数据量
- 实时数据聚合响应 < 2秒

## 🔒 安全特性

- **数据隔离**: 基于用户组的数据访问控制
- **操作审计**: 完整记录所有关键操作日志
- **权限验证**: 出库操作的多级权限检查
- **数据完整性**: 数据库级别的约束和验证

## 📈 扩展能力

### 计划功能
- [ ] AI 需求预测
- [ ] 移动端支持
- [ ] 高级报表分析
- [ ] 第三方系统集成 API

### 集成支持
- **ERP 系统**: SAP、Oracle 等企业级系统
- **电商平台**: 淘宝、京东等电商平台数据同步
- **物流系统**: 顺丰、圆通等物流状态跟踪

## 🤝 贡献指南

### 开发环境设置
```bash
# 克隆开发分支
git clone -b develop https://github.com/nio1112/my-odoo-apps.git

# 安装依赖
pip install -r requirements.txt

# 运行测试
python -m pytest addons/odoo_ask/tests/
```

### 代码规范
- 遵循 Odoo 官方开发规范
- 使用 ESLint 和 Black 进行代码格式化
- 提交前必须通过所有单元测试
- 遵循 Conventional Commits 提交规范

## 📄 许可证

本项目采用 LGPL-3.0 许可证，详见 [LICENSE](LICENSE) 文件。

## 📞 支持与联系

- **项目主页**: https://github.com/nio1112/my-odoo-apps
- **问题反馈**: https://github.com/nio1112/my-odoo-apps/issues
- **邮箱支持**: nio.l@example.com
- **技术文档**: [详细文档](addons/odoo_ask/README.md)

## 🎯 更新日志

### v19.0.1.1 (2025-01-13)
- ✨ 新增问货单创建向导
- 🔧 优化出库验证逻辑
- 📊 完善采购仪表盘功能
- 🐛 修复定时任务执行问题

### v19.0.1.0 (2025-01-01)
- 🎉 初始版本发布
- ✅ 实现核心问货管理功能
- ✅ 完成库存预留系统
- ✅ 支持Docker一键部署

---

⭐ 如果这个项目对您有帮助，请给我们一个 Star！